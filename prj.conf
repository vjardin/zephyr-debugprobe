# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Vincent Jardin <vjardin@free.fr>
#
# Debugprobe Zephyr Port - Project Configuration

# General
CONFIG_MAIN_STACK_SIZE=2048
CONFIG_SYSTEM_WORKQUEUE_STACK_SIZE=2048
CONFIG_HEAP_MEM_POOL_SIZE=8192

# Enable GPIO
CONFIG_GPIO=y

# Enable UART
CONFIG_SERIAL=y
CONFIG_UART_INTERRUPT_DRIVEN=y
CONFIG_UART_LINE_CTRL=y

# Console over USB CDC ACM
CONFIG_CONSOLE=y
CONFIG_UART_CONSOLE=y
CONFIG_PRINTK=y

# Shell for debugging
CONFIG_SHELL=y
CONFIG_SHELL_BACKEND_SERIAL=y
CONFIG_SHELL_PROMPT_UART="debugprobe:~$ "
CONFIG_SHELL_CMDS=y
CONFIG_SHELL_TAB=y
CONFIG_SHELL_TAB_AUTOCOMPLETION=y
CONFIG_SHELL_HISTORY=y
CONFIG_SHELL_HELP=y
CONFIG_SHELL_VT100_COLORS=y
CONFIG_SHELL_METAKEYS=y

# Built-in shell commands for debugging
CONFIG_KERNEL_SHELL=y
CONFIG_DEVICE_SHELL=y
CONFIG_GPIO_SHELL=y
CONFIG_LOG_CMDS=y
CONFIG_REBOOT=y

# Enable new USB device stack
CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_USBD_CDC_ACM_CLASS=y
# Disable auto-init - debugprobe_usbd.c handles USB registration
CONFIG_CDC_ACM_SERIAL_INITIALIZE_AT_BOOT=n

# USB device descriptors (configured via USBD_DEVICE_DEFINE)
# VID/PID set in code: 0x2E8A/0x000C

# Logging for USB (suppress CDC ACM logs to prevent recursion when used as console)
CONFIG_USBD_LOG_LEVEL_WRN=y
CONFIG_UDC_DRIVER_LOG_LEVEL_WRN=y
CONFIG_USBD_CDC_ACM_LOG_LEVEL_OFF=y

# Thread support
CONFIG_MULTITHREADING=y
CONFIG_NUM_PREEMPT_PRIORITIES=16

# Timing
CONFIG_SYS_CLOCK_TICKS_PER_SEC=1000

# Debug/logging
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=2
CONFIG_SHELL_LOG_BACKEND=y

# Ring buffer for USB data
CONFIG_RING_BUFFER=y

# Net buffer for USB device stack
CONFIG_NET_BUF=y

# Flash for storing serial number
CONFIG_FLASH=y
CONFIG_FLASH_PAGE_LAYOUT=y

# Enable PIO (RP2040 specific)
CONFIG_PIO_RPI_PICO=y

# Debugprobe specific
CONFIG_DEBUGPROBE=y
CONFIG_DEBUGPROBE_CDC_UART=y
CONFIG_DEBUGPROBE_DAP=y
CONFIG_DEBUGPROBE_TX_LED=y
CONFIG_DEBUGPROBE_RX_LED=y
CONFIG_DEBUGPROBE_DAP_LED=y

# Optimize for size
CONFIG_SIZE_OPTIMIZATIONS=y
