# SPDX-License-Identifier: MIT
# Copyright (c) 2026 Vincent Jardin <vjardin@free.fr>
#
# Debugprobe Zephyr Port - native_sim configuration
#
# This configuration enables virtual USB for testing the USB stack
# without real hardware using USB/IP and UVB (USB Virtual Bus).

# Disable hardware-specific features not available on native_sim
CONFIG_FLASH=n
CONFIG_FLASH_PAGE_LAYOUT=n

# Disable RP2040-specific PIO driver
CONFIG_PIO_RPI_PICO=n

# Enable USB device stack with virtual USB controller
CONFIG_USB_DEVICE_STACK_NEXT=y
CONFIG_USBD_CDC_ACM_CLASS=y
CONFIG_UDC_DRIVER_LOG_LEVEL_WRN=y
CONFIG_USBD_LOG_LEVEL_WRN=y

# Virtual USB Bus (UVB) for connecting virtual UDC and UHC
CONFIG_UVB=y
CONFIG_UVB_LOG_LEVEL_WRN=y

# USB Host stack (required for USB/IP integration)
CONFIG_USB_HOST_STACK=y
CONFIG_USBH_LOG_LEVEL_WRN=y
CONFIG_UHC_DRIVER_LOG_LEVEL_WRN=y

# USB/IP support for host-side testing
CONFIG_USBIP=y
CONFIG_USBIP_LOG_LEVEL_WRN=y

# Network stack for USB/IP
CONFIG_NETWORKING=y
CONFIG_NET_IPV4=y
CONFIG_NET_TCP=y
CONFIG_NET_SOCKETS=y
CONFIG_NET_CONFIG_SETTINGS=y
CONFIG_NET_CONFIG_NEED_IPV4=y
CONFIG_NET_CONFIG_MY_IPV4_ADDR="192.0.2.1"
CONFIG_NET_CONFIG_PEER_IPV4_ADDR="192.0.2.2"

# USB buffer settings
CONFIG_UHC_BUF_COUNT=32
CONFIG_UHC_XFER_COUNT=32

# Timing - high resolution for USB
CONFIG_SYS_CLOCK_TICKS_PER_SEC=1000000

# Disable debugprobe features that require hardware (SWD, PIO, etc.)
CONFIG_DEBUGPROBE=y
CONFIG_DEBUGPROBE_CDC_UART=y
CONFIG_DEBUGPROBE_DAP=n
CONFIG_DEBUGPROBE_TX_LED=n
CONFIG_DEBUGPROBE_RX_LED=n
CONFIG_DEBUGPROBE_DAP_LED=n
CONFIG_DEBUGPROBE_AUTOBAUD=n

# Keep basic infrastructure
CONFIG_GPIO=y
CONFIG_SERIAL=y
CONFIG_LOG=y
CONFIG_LOG_DEFAULT_LEVEL=3
